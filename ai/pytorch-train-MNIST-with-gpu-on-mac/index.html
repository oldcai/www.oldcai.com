<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="If you’re a Mac user and looking to leverage the power of your new Apple Silicon M2 chip for machine learning with PyTorch, you’re in luck. In this blog post, we’ll cover how to set up PyTorch and opt">
<meta property="og:type" content="article">
<meta property="og:title" content="Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark">
<meta property="og:url" content="https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/">
<meta property="og:site_name" content="老菜博客">
<meta property="og:description" content="If you’re a Mac user and looking to leverage the power of your new Apple Silicon M2 chip for machine learning with PyTorch, you’re in luck. In this blog post, we’ll cover how to set up PyTorch and opt">
<meta property="og:locale">
<meta property="og:image" content="https://i.imgur.com/kRnDZFK.png">
<meta property="article:published_time" content="2022-12-15T14:24:09.000Z">
<meta property="article:modified_time" content="2024-01-29T07:01:34.187Z">
<meta property="article:author" content="oldcai">
<meta property="article:tag" content="pytorch">
<meta property="article:tag" content="benchmark">
<meta property="article:tag" content="macOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/kRnDZFK.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="老菜博客" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Categories</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/friends/">Friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Archives</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/programing/python-microsoft-audio/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/server/large-postgresql-database-migration/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&text=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&is_video=false&description=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark&body=Check out this article: https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&name=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&t=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-Install"><span class="toc-number">1.</span> <span class="toc-text">How to Install</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Show-Me-the-Code"><span class="toc-number">2.</span> <span class="toc-text">Show Me the Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Benchmark"><span class="toc-number">3.</span> <span class="toc-text">Benchmark</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">oldcai</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-15T14:24:09.000Z" itemprop="datePublished">2022-12-15</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/ai/">ai</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/benchmark/" rel="tag">benchmark</a>, <a class="tag-link-link" href="/tags/macOS/" rel="tag">macOS</a>, <a class="tag-link-link" href="/tags/pytorch/" rel="tag">pytorch</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>If you’re a Mac user and looking to leverage the power of your new Apple Silicon M2 chip for machine learning with PyTorch, you’re in luck. In this blog post, we’ll cover how to set up PyTorch and optimizing your training performance with GPU acceleration on your M2 chip.</p>
<p>We’ll also include some benchmark results to give you an idea of the potential speedup you can expect. So if you’re ready to get started with PyTorch on your M2 chip, read on!</p>
<h2 id="How-to-Install"><a href="#How-to-Install" class="headerlink" title="How to Install"></a>How to Install</h2><p>Note that the MPS acceleration is not available until macOS 12.3+</p>
<p>If you have the anaconda or miniconda installed. You can install it by using command <code>conda install pytorch torchvision -c pytorch-nightly</code></p>
<p>Here is the GPU utilisation after using this version of pytorch to train the MNIST handwriting dataset.</p>
<p><img src="https://i.imgur.com/kRnDZFK.png" alt="GPU"></p>
<h2 id="Show-Me-the-Code"><a href="#Show-Me-the-Code" class="headerlink" title="Show Me the Code"></a>Show Me the Code</h2><p>This demo uses PyTorch to build a handwriting recognition model. It also uses the MNIST dataset, which consists of images of handwritten digits, and trains a convolutional neural network (CNN) to classify the images.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torchvision.datasets <span class="keyword">import</span> MNIST</span><br><span class="line"><span class="keyword">from</span> torchvision.transforms <span class="keyword">import</span> ToTensor</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PyTorch version: <span class="subst">&#123;torch.__version__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check PyTorch has access to MPS (Metal Performance Shader, Apple&#x27;s GPU architecture)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Is MPS (Metal Performance Shader) built? <span class="subst">&#123;torch.backends.mps.is_built()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Is MPS available? <span class="subst">&#123;torch.backends.mps.is_available()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the device</span></span><br><span class="line">device = <span class="string">&quot;mps&quot;</span> <span class="keyword">if</span> torch.backends.mps.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">device = torch.device(device)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Using device: <span class="subst">&#123;device&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the CNN model</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HandwritingRecognitionModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Define the convolutional layers</span></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">1</span>, <span class="number">16</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">16</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Define the pooling and dropout layers</span></span><br><span class="line">        self.pool = nn.MaxPool2d(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">        self.dropout1 = nn.Dropout(<span class="number">0.25</span>)</span><br><span class="line">        self.dropout2 = nn.Dropout(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Define the fully connected layers</span></span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">32</span> * <span class="number">7</span> * <span class="number">7</span>, <span class="number">128</span>)</span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">128</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># Pass the input through the convolutional layers</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.pool(x)</span><br><span class="line">        x = self.dropout1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        x = self.pool(x)</span><br><span class="line">        x = self.dropout2(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Reshape the output for the fully connected layers</span></span><br><span class="line">        x = x.view(-<span class="number">1</span>, <span class="number">32</span> * <span class="number">7</span> * <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Pass the output through the fully connected layers</span></span><br><span class="line">        x = self.fc1(x)</span><br><span class="line">        x = self.fc2(x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Return the final output</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the MNIST dataset</span></span><br><span class="line">train_dataset = MNIST(<span class="string">&quot;./data&quot;</span>, train=<span class="literal">True</span>, download=<span class="literal">True</span>, transform=ToTensor())</span><br><span class="line">test_dataset = MNIST(<span class="string">&quot;./data&quot;</span>, train=<span class="literal">False</span>, download=<span class="literal">True</span>, transform=ToTensor())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the data loaders</span></span><br><span class="line">train_loader = DataLoader(train_dataset, batch_size=<span class="number">64</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line">test_loader = DataLoader(test_dataset, batch_size=<span class="number">64</span>, shuffle=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the model</span></span><br><span class="line">model = HandwritingRecognitionModel().to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the loss function and optimizer</span></span><br><span class="line">loss_fn = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=<span class="number">1e-3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the model for 10 epochs</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="comment"># Set the model to training mode</span></span><br><span class="line">    model.train()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Iterate over the training data</span></span><br><span class="line">    <span class="keyword">for</span> images, labels <span class="keyword">in</span> train_loader:</span><br><span class="line">        images, labels = images.to(device), labels.to(device)</span><br><span class="line">        <span class="comment"># Pass the input through the model</span></span><br><span class="line">        outputs = model(images)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Compute the loss</span></span><br><span class="line">        loss = loss_fn(outputs, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Backpropagate the error</span></span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Update the model parameters</span></span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Set the model to evaluation mode</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Evaluate the model on the validation set</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        correct = <span class="number">0</span></span><br><span class="line">        total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> images, labels <span class="keyword">in</span> test_loader:</span><br><span class="line">            images, labels = images.to(device), labels.to(device)</span><br><span class="line">            <span class="comment"># Pass the input through the model</span></span><br><span class="line">            outputs = model(images)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Get the predicted labels</span></span><br><span class="line">            _, predicted = torch.<span class="built_in">max</span>(outputs.data, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Update the total and correct counts</span></span><br><span class="line">            total += labels.size(<span class="number">0</span>)</span><br><span class="line">            correct += (predicted == labels).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Print the accuracy</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>: Accuracy = <span class="subst">&#123;<span class="number">100</span> * correct / total:<span class="number">.2</span>f&#125;</span>%&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>It’s 1.5 times faster than the CPU version of code.</p>
<h2 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h2><p>The output of the MPS version, which utilises the GPU, is as below.</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PyTorch</span> version: <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>.dev20221214</span><br><span class="line"><span class="attribute">Is</span> MPS (Metal Performance Shader) built? True</span><br><span class="line"><span class="attribute">Is</span> MPS available? True</span><br><span class="line"><span class="attribute">Using</span> device: mps</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">1</span>: Accuracy = <span class="number">62</span>.<span class="number">04</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">2</span>: Accuracy = <span class="number">81</span>.<span class="number">67</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">3</span>: Accuracy = <span class="number">89</span>.<span class="number">39</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">4</span>: Accuracy = <span class="number">89</span>.<span class="number">84</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">5</span>: Accuracy = <span class="number">89</span>.<span class="number">87</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">6</span>: Accuracy = <span class="number">91</span>.<span class="number">45</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">7</span>: Accuracy = <span class="number">94</span>.<span class="number">71</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">8</span>: Accuracy = <span class="number">93</span>.<span class="number">32</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">9</span>: Accuracy = <span class="number">95</span>.<span class="number">26</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">10</span>: Accuracy = <span class="number">94</span>.<span class="number">63</span>%</span><br><span class="line"></span><br><span class="line"><span class="attribute">________________________________________________________</span></span><br><span class="line"><span class="attribute">Executed</span> in   <span class="number">55</span>.<span class="number">08</span> secs    fish           external</span><br><span class="line">   <span class="attribute">usr</span> time   <span class="number">49</span>.<span class="number">89</span> secs   <span class="number">64</span>.<span class="number">00</span> micros   <span class="number">49</span>.<span class="number">89</span> secs</span><br><span class="line">   <span class="attribute">sys</span> time    <span class="number">5</span>.<span class="number">13</span> secs  <span class="number">921</span>.<span class="number">00</span> micros    <span class="number">5</span>.<span class="number">13</span> secs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The output of the CPU version is as below.</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PyTorch</span> version: <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>.dev20221214</span><br><span class="line"><span class="attribute">Is</span> MPS (Metal Performance Shader) built? True</span><br><span class="line"><span class="attribute">Is</span> MPS available? True</span><br><span class="line"><span class="attribute">Using</span> device: cpu</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">1</span>: Accuracy = <span class="number">49</span>.<span class="number">73</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">2</span>: Accuracy = <span class="number">73</span>.<span class="number">65</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">3</span>: Accuracy = <span class="number">88</span>.<span class="number">25</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">4</span>: Accuracy = <span class="number">86</span>.<span class="number">27</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">5</span>: Accuracy = <span class="number">90</span>.<span class="number">01</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">6</span>: Accuracy = <span class="number">94</span>.<span class="number">28</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">7</span>: Accuracy = <span class="number">92</span>.<span class="number">18</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">8</span>: Accuracy = <span class="number">86</span>.<span class="number">54</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">9</span>: Accuracy = <span class="number">90</span>.<span class="number">70</span>%</span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">10</span>: Accuracy = <span class="number">93</span>.<span class="number">63</span>%</span><br><span class="line"></span><br><span class="line"><span class="attribute">________________________________________________________</span></span><br><span class="line"><span class="attribute">Executed</span> in  <span class="number">141</span>.<span class="number">26</span> secs    fish           external</span><br><span class="line">   <span class="attribute">usr</span> time  <span class="number">202</span>.<span class="number">16</span> secs    <span class="number">0</span>.<span class="number">07</span> millis  <span class="number">202</span>.<span class="number">16</span> secs</span><br><span class="line">   <span class="attribute">sys</span> time   <span class="number">69</span>.<span class="number">79</span> secs    <span class="number">1</span>.<span class="number">19</span> millis   <span class="number">69</span>.<span class="number">79</span> secs   </span><br></pre></td></tr></table></figure>

<p>Both the CPU and GPU in this benchmark were on the same M2 chip.</p>
<p>The time spent with the CPU was 141.26 seconds, about 2.5 times the GPU version.</p>
<p>Although it’s not too much of an improvement if compared to the newest NVIDIA GPUs, it is still a great leap for Mac users in the Machine Learning field.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/friends/">Friends</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-Install"><span class="toc-number">1.</span> <span class="toc-text">How to Install</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Show-Me-the-Code"><span class="toc-number">2.</span> <span class="toc-text">Show Me the Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Benchmark"><span class="toc-number">3.</span> <span class="toc-text">Benchmark</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&text=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&is_video=false&description=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark&body=Check out this article: https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&title=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&name=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.oldcai.com/ai/pytorch-train-MNIST-with-gpu-on-mac/&t=Train PyTorch With GPU Acceleration on Mac, Apple Silicon M2 Chip Machine Learning Benchmark"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    oldcai
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/categories/">Categories</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/friends/">Friends</a></li><!--
     --><!--
       --><li><a href="/archives/">Archives</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8814571279145017"
     crossorigin="anonymous"></script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8814571279145017",
          enable_page_level_ads: true
     });
</script>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->


<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0RK1QH308"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'ad_storage': 'granted',
            'analytics_storage': 'granted',
            'wait_for_update': 500,
        });
        gtag('js', new Date());
        gtag('config', 'G-K0RK1QH308');
    </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


</body>
</html>
